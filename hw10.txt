1. Создание базы:
CREATE DATABASE cinema;

2. Создание таблиц:
CREATE TABLE cinema_object (
id SERIAL NOT NULL,
name VARCHAR(255) NOT NULL,
PRIMARY KEY (id));

CREATE TABLE hall_object (
id SERIAL NOT NULL,
hall_number INT NOT NULL,
cinema_id INT NOT NULL,
PRIMARY KEY (id));

CREATE TABLE film_object (
id SERIAL NOT NULL,
film_name VARCHAR(255) NOT NULL,
release_year INT NOT NULL,
PRIMARY KEY (id));

CREATE TABLE film_session (
id SERIAL NOT NULL,
time DATE NOT NULL,
film_id INT NOT NULL,
hall_id INT NOT NULL,
PRIMARY KEY (id));

CREATE TABLE ticket_object (
id SERIAL NOT NULL,
type VARCHAR(45) NOT NULL,
price DECIMAL NOT NULL,
PRIMARY KEY (id));

CREATE TABLE ticket_sale (
id SERIAL NOT NULL,
film_session_id INT NOT NULL,
ticket_type_id INT NOT NULL,
sold INT NOT NULL,
PRIMARY KEY (id));

3. Создание пользователя с правами readonly:
CREATE ROLE usr1 WITH LOGIN PASSWORD 'qwerty';

4. Для соединения пароль в. pgpass
Создал в домашней директории пользователя postgres файл .pgpass
в нем:
#сервер:порт:база_данных:имя_пользователя:пароль
127.0.0.1:5432:cinema:postgres:123456

5. Создать отдельный tablespace для индексов имя "tsFastIndex". 
mkdir /var/lib/postgresql/tablespaces
CREATE TABLESPACE "tsFastIndex" LOCATION '/var/lib/postgresql/tablespaces';
ALTER INDEX cinema_object_pkey SET TABLESPACE "tsFastIndex";
ALTER INDEX film_object_pkey SET TABLESPACE "tsFastIndex";
ALTER INDEX film_session_pkey SET TABLESPACE "tsFastIndex";
ALTER INDEX hall_object_pkey SET TABLESPACE "tsFastIndex";
ALTER INDEX ticket_object_pkey SET TABLESPACE "tsFastIndex";
ALTER INDEX ticket_sale_pkey SET TABLESPACE "tsFastIndex";

CREATE [ UNIQUE ] INDEX [ CONCURRENTLY ] [ [ IF NOT EXISTS ] имя ] ON [ ONLY ] имя_таблицы [ USING метод ]
    ( { имя_столбца | ( выражение ) } [ COLLATE правило_сортировки ] [ класс_операторов ] [ ASC | DESC ] [ NULLS { FIRST | LAST } ] [, ...] )
    [ INCLUDE ( имя_столбца [, ...] ) ]
    [ WITH ( параметр_хранения = значение [, ... ] ) ]
    [ TABLESPACE табл_пространство ]
    [ WHERE предикат ]

6. Подготовить 2 скрипта для бэкапа: рабочая база и все пользователи кластера.
postgres@2cafa8f810b7:~$ pg_dump -h 127.0.0.1 -p 5432 -U postgres cinema > cinema_backup.sql
postgres@2cafa8f810b7:~$ cat cinema_backup.sql 
--
-- PostgreSQL database dump
--

-- Dumped from database version 11.4 (Debian 11.4-1.pgdg90+1)
-- Dumped by pg_dump version 11.4 (Debian 11.4-1.pgdg90+1)

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

SET default_tablespace = '';

SET default_with_oids = false;

--
-- Name: cinema_object; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.cinema_object (
    id integer NOT NULL,
    name character varying(255) NOT NULL
);


ALTER TABLE public.cinema_object OWNER TO postgres;

--
-- Name: cinema_object_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.cinema_object_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.cinema_object_id_seq OWNER TO postgres;

--
-- Name: cinema_object_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.cinema_object_id_seq OWNED BY public.cinema_object.id;


--
-- Name: film_object; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.film_object (
    id integer NOT NULL,
    film_name character varying(255) NOT NULL,
    release_year integer NOT NULL
);


ALTER TABLE public.film_object OWNER TO postgres;

--
-- Name: film_object_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.film_object_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.film_object_id_seq OWNER TO postgres;

--
-- Name: film_object_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.film_object_id_seq OWNED BY public.film_object.id;


--
-- Name: film_session; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.film_session (
    id integer NOT NULL,
    "time" date NOT NULL,
    film_id integer NOT NULL,
    hall_id integer NOT NULL
);


ALTER TABLE public.film_session OWNER TO postgres;

--
-- Name: film_session_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.film_session_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.film_session_id_seq OWNER TO postgres;

--
-- Name: film_session_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.film_session_id_seq OWNED BY public.film_session.id;


--
-- Name: hall_object; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.hall_object (
    id integer NOT NULL,
    hall_number integer NOT NULL,
    cinema_id integer NOT NULL
);


ALTER TABLE public.hall_object OWNER TO postgres;

--
-- Name: hall_object_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.hall_object_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.hall_object_id_seq OWNER TO postgres;

--
-- Name: hall_object_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.hall_object_id_seq OWNED BY public.hall_object.id;


--
-- Name: ticket_object; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.ticket_object (
    id integer NOT NULL,
    type character varying(45) NOT NULL,
    price numeric NOT NULL
);


ALTER TABLE public.ticket_object OWNER TO postgres;

--
-- Name: ticket_object_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.ticket_object_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.ticket_object_id_seq OWNER TO postgres;

--
-- Name: ticket_object_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.ticket_object_id_seq OWNED BY public.ticket_object.id;


--
-- Name: ticket_sale; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.ticket_sale (
    id integer NOT NULL,
    film_session_id integer NOT NULL,
    ticket_type_id integer NOT NULL,
    sold integer NOT NULL
);


ALTER TABLE public.ticket_sale OWNER TO postgres;

--
-- Name: ticket_sale_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.ticket_sale_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.ticket_sale_id_seq OWNER TO postgres;

--
-- Name: ticket_sale_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.ticket_sale_id_seq OWNED BY public.ticket_sale.id;


--
-- Name: cinema_object id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.cinema_object ALTER COLUMN id SET DEFAULT nextval('public.cinema_object_id_seq'::regclass);


--
-- Name: film_object id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.film_object ALTER COLUMN id SET DEFAULT nextval('public.film_object_id_seq'::regclass);


--
-- Name: film_session id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.film_session ALTER COLUMN id SET DEFAULT nextval('public.film_session_id_seq'::regclass);


--
-- Name: hall_object id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.hall_object ALTER COLUMN id SET DEFAULT nextval('public.hall_object_id_seq'::regclass);


--
-- Name: ticket_object id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket_object ALTER COLUMN id SET DEFAULT nextval('public.ticket_object_id_seq'::regclass);


--
-- Name: ticket_sale id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket_sale ALTER COLUMN id SET DEFAULT nextval('public.ticket_sale_id_seq'::regclass);


--
-- Data for Name: cinema_object; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.cinema_object (id, name) FROM stdin;
\.


--
-- Data for Name: film_object; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.film_object (id, film_name, release_year) FROM stdin;
\.


--
-- Data for Name: film_session; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.film_session (id, "time", film_id, hall_id) FROM stdin;
\.


--
-- Data for Name: hall_object; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.hall_object (id, hall_number, cinema_id) FROM stdin;
\.


--
-- Data for Name: ticket_object; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.ticket_object (id, type, price) FROM stdin;
\.


--
-- Data for Name: ticket_sale; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.ticket_sale (id, film_session_id, ticket_type_id, sold) FROM stdin;
\.


--
-- Name: cinema_object_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.cinema_object_id_seq', 1, false);


--
-- Name: film_object_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.film_object_id_seq', 1, false);


--
-- Name: film_session_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.film_session_id_seq', 1, false);


--
-- Name: hall_object_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.hall_object_id_seq', 1, false);


--
-- Name: ticket_object_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.ticket_object_id_seq', 1, false);


--
-- Name: ticket_sale_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.ticket_sale_id_seq', 1, false);


SET default_tablespace = "tsFastIndex";

--
-- Name: cinema_object cinema_object_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: tsFastIndex
--

ALTER TABLE ONLY public.cinema_object
    ADD CONSTRAINT cinema_object_pkey PRIMARY KEY (id);


SET default_tablespace = '';

--
-- Name: film_object film_object_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.film_object
    ADD CONSTRAINT film_object_pkey PRIMARY KEY (id);


--
-- Name: film_session film_session_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.film_session
    ADD CONSTRAINT film_session_pkey PRIMARY KEY (id);


--
-- Name: hall_object hall_object_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.hall_object
    ADD CONSTRAINT hall_object_pkey PRIMARY KEY (id);


--
-- Name: ticket_object ticket_object_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket_object
    ADD CONSTRAINT ticket_object_pkey PRIMARY KEY (id);


--
-- Name: ticket_sale ticket_sale_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket_sale
    ADD CONSTRAINT ticket_sale_pkey PRIMARY KEY (id);


--
-- PostgreSQL database dump complete
--

postgres@2cafa8f810b7:~$ pg_dumpall -h 127.0.0.1 -p 5432 -U postgres -r > role_backup.sql
postgres@2cafa8f810b7:~$ cat role_backup.sql 
--
-- PostgreSQL database cluster dump
--

SET default_transaction_read_only = off;

SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;

--
-- Roles
--

CREATE ROLE postgres;
ALTER ROLE postgres WITH SUPERUSER INHERIT CREATEROLE CREATEDB LOGIN REPLICATION BYPASSRLS;
CREATE ROLE usr1;
ALTER ROLE usr1 WITH NOSUPERUSER INHERIT NOCREATEROLE NOCREATEDB LOGIN NOREPLICATION NOBYPASSRLS PASSWORD 'md5998a71a93bd7c837716c826e0bb0ff96';




--
-- PostgreSQL database cluster dump complete
--
